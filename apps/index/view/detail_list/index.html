<html>
	<head>
		<meta name="viewport" content="width=device-width,height=device-height,maximum-scale=1.0">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<link type="text/css" href='__static__/css/detaillist.css' rel="stylesheet"></link>
		<script src='__static__/js/jquery.min.js'></script>

	</head>
	<body>
		<div id='a'></div>
		<input type='hidden' class='t' value='{$t}'  />
		<input type='hidden' class='r' value='{$r}'  />
		<div id='mob_index'>
			{include file='index/top' }
			<div id='top_pic'><img src='__static__/img/Ban_kxaj.jpg' /></div>
			<div id='main_index'>
				<div id='list_serach'>
					<div id='search'>
						<input type='text'  id='index_text' placeholder="输入地铁,商圈,小区名字等..."/><input type='image' src='__static__/img/magnifying42.png' id='index_sub' />						
					</div>
					<a id='map' href="{:url('map/index')}" style="margin-top: 4%;"><img src="__static__/img/map.png" /></a>
				</div>
			
				<div id='list_choose'>
					<ul>
						<li><div id='h_map' class="m_li">地图</div><img src='__static__/img/p_2.png' /></li>
						<li><div id='h_type' class="m_li">户型</div><img src='__static__/img/p_2.png' /></li>
						<li><div id='h_price' class="m_li">租金</div><img src='__static__/img/p_2.png' /></li>
						<li><div id='h_select' class="m_li">筛选</div><img src='__static__/img/p_2.png' /></li>
					</ul>
				</div>

					<div id='main_list'>
					<ul>
						{foreach name='house' id='house_list'}
						<li onclick="gotodetail({$house_list.id})" >
							<div class='list_detail'  >
								<div class='list_detail_left'>
									<img src='__pic__/uploads/{$house_list.pic_1}'  />
									<div class="sta h_status_{$house_list.house_status}">{$house_list.house_status_name}</div>
								</div>
								<div class='list_detail_right'>
									<div class='list_detail_title' >
										<span>{$house_list.title|truncate_cn=30,'...',0}</span>
									</div>
									<div class='list_detail_content'>

										{$house_list.acreage}m<sup>2</sup>&nbsp;&nbsp;|&nbsp;&nbsp;{$house_list.house_floor}层<span style='margin-left:6%;color:orange;'><span style='font-size:150%;'>￥{$house_list.price}</span>元/月</span><br />
										<img src='__static__/img/p_1.png' style='width:8%;	vertical-align:middle;'/>{$house_list.underground}<span style="padding-right: 21%;float: right;">{$house_list.address}</span><br  />

										<?php 
										foreach($house_list['key_word_list'] as $val){ ?>
											<div class='key_word'><?php echo $val;?></div>
										<?php	
										}	
										?>
									</div>
									<!--<div class='list_detail_price'>
										{$house_list.price}
									</div>-->
								</div>
							</div>
						</li>
							{/foreach}
					</ul>
				</div>
			</div>
			<!--<input type="button" value="加载更多" class="read_more"/>-->
		</div>
		<div id='house_type_list' class='meau_list'>
			<p>选择房型</p>
				{foreach name='type' id='type'}
				<li class='h_select_tese' value='{$type.t_id}'>{$type.house_type_name}</li>
				{/foreach}
			<br />
			<br />
			<br /><input type='button' id='type_check' value='确定' style="margin:0 auto;" />
		</div>
		<div id='list_area_detail' class='list meau_list'>
			<p>选择地区</p>
			<div class='area_detail_left'>
				{foreach name='location' id='loc_list'}
				<li value='{$loc_list.l_id}'>{$loc_list.location_name}</li>
				{/foreach}
			</div>
			<div class='area_detail_right'>
				
			</div>
		</div>
		<div id='line_area_detail' class='list'>
			<div class='area_detail_left'>
				{foreach name='line' id='line_list'}
				<li value='{$line_list.u_id}'>{$line_list.underground_name}</li>
				{/foreach}
			</div>
			<div class='area_detail_right'>
				
			</div>
		</div>
		<div id='h_price_detail' class="meau_list">
			<p>选择价格</p>
			<ul>
				<li><input type="hidden" value="" />不限</li>
				<li><input type="hidden" value="0,4000" />4000元以下</li>
				<li><input type="hidden" value="4000,6000" />4000-6000元</li>
				<li><input type="hidden" value="6000,8000" />6000-8000元</li>
				<li><input type="hidden" value="8000,10000" />8000-10000元</li>
				<li><input type="hidden" value="10000,0" />10000元以上</li>
			</ul>
			<div class="demo">
				<input class="range-slider" type="hidden" value="0,10001" />
			</div>
			<input type='button' id='price_reset' value='重置'  /><input type='button' id='price_check' value='确定'  />
			<div style='padding-bottom:10%'></div>
		</div>
		<div id='h_select_detail' class="meau_list">
			<p>更多选择</p>
			<div style='text-align: center;color: #AAAAAA;'>朝向</div>
			<input type='button' class='h_select_chao' value='南'>
			<input type='button' class='h_select_chao' value='北'>
			<input type='button' class='h_select_chao' value='东'>
			<input type='button' class='h_select_chao' value='西'>
			<input type='button' class='h_select_chao' value='南北'>	
			<div style='text-align: center;padding-top:5%;color: #AAAAAA;'>房屋特色</div>
			{foreach name='key_word' id='keyy'}
			<input type='button' class='h_select_tese' value='{$keyy.key_word_name}' />
			{/foreach}
			<br />
			<br />
			<br />
			<input type='button' id='char_reset' value='重置'  /><input type='button' id='char_check' value='确定'  />
			<div style='padding-bottom:10%'></div>
		</div>
	</body>
</html>
<script src='__static__/js/detaillist.js'></script>
<link rel="stylesheet" href="__static__/css/jquery.range.css" />
<script src="http://www.jq22.com/jquery/jquery-1.10.2.js"></script>
<script type="text/javascript" src="__static__/js/jquery.range.js"></script>
<script type='text/javascript'>
    $(function() {
        if($('.t').val() == 3){
            $('#h_price').html('售价');
        }
        })
    $(window).scroll(
        function() {
            var scrollTop = $(this).scrollTop() || window.pageYOffset;
            var scrollHeight = $(document).height();
            var windowHeight = $(window).innerHeight();
            //console.log($('#main_list li').length);
//           console.log(scrollTop + '+' + windowHeight + '=' + scrollHeight);
            if (scrollTop + windowHeight == scrollHeight) {
               console.log(1111);
                $.ajax({
                    type: "POST",
                    url: "{:url('detail_list/more_list')}",
                    data: {'a': $('#main_list li').length, 't': $('.t').val(), 'r': $('.r').val()},// 序列化表单值
                    dataType: "json",
                    success: function (data) {

                        var ob = '';
                        $.each(data, function (i, value) {
                            ob = ob + "<li><div class='list_detail'  onclick='gotodetail(" + value.id + ")'><div class='list_detail_left'><img src='__pic__/uploads/" + value.pic_1 + "'  /></div><div class='list_detail_right'><div class='list_detail_title' ><span>" + value.title.substring(0, 30) + "..." + "</span></div><div class='list_detail_content'>" + value.acreage + "m<sup>2</sup>&nbsp;&nbsp;|&nbsp;&nbsp;" + value.house_floor + "层<span style='margin-left:6%;color:orange;'><span style='font-size:150%;'>￥" + value.price + "</span>元/月</span><br /><img src='__static__/img/p_1.png' style='width:8%;vertical-align:middle;'/>" + value.underground + "..." + "<span style='padding-left: 34%;'>" + value.address + "</span><br  />";
                            $.each(value.key_word_list, function (j, val) {
                                ob = ob + "<div class='key_word'>" + val + "</div>";
                            })
                            ob = ob + "</div></div></div></li>";
                        })
                        $('#main_list ul').append(ob);
                    },
                    error:function(){
                      alert('没有更多了');
					}
                });
            }
        });
$('.range-slider').jRange({
		from: 0,
		to: 10000,
		step: 1,
		scale: [0,2000,4000,6000,8000,'不限'],
		format: '%s',
		width: 300,
		showLabels: true,
		isRange: true
	});
	$('#index_sub').click(function(){
		$(location).prop('href',"{:url('index')}?a="+$('.t').val()+"&res="+$('#index_text').val());
	})
	function gotodetail(id){
        //$(location).prop('href','__back__/index.php/index/detail/index/id/'+id);
		window.location.href="{:url('detail/index')}?id="+id;
	}
$('#price_check').click(function(){
    var data;
    if($('.range-slider').val() !="0,10001"){
        data = $('.range-slider').val();
    }else{
        data = $('.check input[type="hidden"]').val();
    }
    $.ajax(
        {
            type: "POST",
            url:"{:url('detail_list/search_price')}",
            data:{'price':data,'type':$('.t').val()},// 序列化表单值
            dataType: "json",
            success: function(data) {
                //alert('yes');
                $('#main_list ul').empty();
                var ob = '';
                $.each(data,function(i,value){
                    ob = ob+"<li><div class='list_detail'  onclick='gotodetail("+value.id+")'><div class='list_detail_left'><img src='__pic__/uploads/"+value.pic_1+"'  /></div><div class='list_detail_right'><div class='list_detail_title' ><span>"+value.title.substring(0,30)+"..."+"</span></div><div class='list_detail_content'>"+value.acreage+"m<sup>2</sup>&nbsp;&nbsp;|&nbsp;&nbsp;"+value.house_floor+"层<span style='margin-left:6%;color:orange;'><span style='font-size:150%;'>￥"+value.price+"</span>元/月</span><br /><img src='__static__/img/p_1.png' style='width:8%;vertical-align:middle;'/>"+value.underground+"..."+"<span style='padding-left: 34%;'>"+value.address+"</span><br  />";
                    $.each(value.key_word_list,function(j,val){
							ob = ob+ "<div class='key_word'>"+val+"</div>";
                    })
					ob = ob+ "</div></div></div></li>";
                })
                $('#main_list ul').append(ob);
                $('#h_price_detail').css('left','-100%');
            },
            error:function(){
                alert('没有结果');
			}
        }
    );
})
//	$('.main_list li').on('touchstart',function(){
//	    $(this).find('.sta').css('display','block');
//	})
//	$('.main_list li').click(function(){
////        $(this).find('.sta').css('display','none');
//		gotodetail($(this).val());
//	})
var flag = 1;
$('.h_select_chao,.h_select_tese').click(function(){
    if(flag == 1){
        $(this).addClass('select_check');
        flag = 0;
    } else{
        $(this).removeClass('select_check');
        flag = 1;
    }
})
$('#char_reset').click(function(){
    $('.h_select_chao,.h_select_tese').removeClass('select_check');
})

$('#char_check').click(function(){
    var chao = new Array();
    var k = 0;
    $(".h_select_chao.select_check").each(function(){
        chao[k] =  $(this).val();
        k++;
    });
    var tese = new Array();
    var z = 0;
    $(".h_select_tese.select_check").each(function(){
        tese[z] =  $(this).val();
        z++;
    });
	if(z == 0){
	    tese = '';
	}else if(k == 0){
	    chao = '';
	}
    $.ajax(
        {
            type: "POST",
            url:"{:url('detail_list/search_char')}",
            data:{'chao':chao,'tese':tese,'type':$('.t').val()},// 序列化表单值
            dataType: "json",
            success: function(data) {
                $('#main_list ul').empty();
                var ob = '';
                $.each(data,function(i,value){
                    ob = ob+"<li><div class='list_detail'  onclick='gotodetail("+value.id+")'><div class='list_detail_left'><img src='__pic__/uploads/"+value.pic_1+"'  /></div><div class='list_detail_right'><div class='list_detail_title' ><span>"+value.title.substring(0,30)+"..."+"</span></div><div class='list_detail_content'>"+value.acreage+"m<sup>2</sup>&nbsp;&nbsp;|&nbsp;&nbsp;"+value.house_floor+"层<span style='margin-left:6%;color:orange;'><span style='font-size:150%;'>￥"+value.price+"</span>元/月</span><br /><img src='__static__/img/p_1.png' style='width:8%;vertical-align:middle;'/>"+value.underground+"..."+"<span style='padding-left: 34%;'>"+value.address+"</span><br  />";
                    $.each(value.key_word_list,function(j,val){
                        ob = ob+ "<div class='key_word'>"+val+"</div>";
                    })
                    ob = ob+ "</div></div></div></li>";
                })
                $('#main_list ul').append(ob);
                $('#h_select_detail').css('left','-100%');
            },
            error:function(){
                alert('没有结果');
            }
        }
    );
})
    $('#type_check').click(function(){
        var tp = new Array();
        var k = 0;
        $(".h_select_tese.select_check").each(function(){
            tp[k] =  $(this).val();
            k++;
        });
		if(k == 0){
            tp = '';
        }
        $.ajax(
            {
                type: "POST",
                url:"{:url('detail_list/search_type')}",
                data:{'h_tp':tp,'type':$('.t').val()},// 序列化表单值
                dataType: "json",
                success: function(data) {
                    $('#main_list ul').empty();
                    var ob = '';
                    $.each(data,function(i,value){
                        ob = ob+"<li><div class='list_detail'  onclick='gotodetail("+value.id+")'><div class='list_detail_left'><img src='__pic__/uploads/"+value.pic_1+"'  /></div><div class='list_detail_right'><div class='list_detail_title' ><span>"+value.title.substring(0,30)+"..."+"</span></div><div class='list_detail_content'>"+value.acreage+"m<sup>2</sup>&nbsp;&nbsp;|&nbsp;&nbsp;"+value.house_floor+"层<span style='margin-left:6%;color:orange;'><span style='font-size:150%;'>￥"+value.price+"</span>元/月</span><br /><img src='__static__/img/p_1.png' style='width:8%;vertical-align:middle;'/>"+value.underground+"..."+"<span style='padding-left: 34%;'>"+value.address+"</span><br  />";
                        $.each(value.key_word_list,function(j,val){
                            ob = ob+ "<div class='key_word'>"+val+"</div>";
                        })
                        ob = ob+ "</div></div></div></li>";
                    })
                    $('#main_list ul').append(ob);
                    $('#house_type_list').css('left','-100%');
                },
                error:function(){
                    alert('没有结果');
                }
            }
        );
    })
</script>